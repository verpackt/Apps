
import streamlit as st
import fitz  # PyMuPDF
from io import BytesIO
import openai

st.set_page_config(page_title="Resumen de Libros en PDF", layout="wide")
st.title("IA: Resumen y Audio de Libros en PDF")

# Paso 1: Subir PDF
uploaded_file = st.file_uploader("Carga tu archivo PDF", type=["pdf"])

# Paso 2: Configurar OpenAI API Key
openai_api_key = st.text_input("Tu clave API de OpenAI (requerida para resumir)", type="password")

# Paso 3: Procesar PDF
if uploaded_file and openai_api_key:
    doc = fitz.open(stream=uploaded_file.read(), filetype="pdf")
    full_text = ""
    for page in doc:
        full_text += page.get_text()
    st.subheader("Texto extraído (primeras 1000 palabras)")
    st.write(full_text[:1000])

    if st.button("Generar resumen general"):
        with st.spinner("Generando resumen..."):
            prompt = (
                "Resume el siguiente contenido de un libro como si fuera una sinopsis ejecutiva de 1-2 páginas:

"
                + full_text[:6000]
            )
            openai.api_key = openai_api_key
            response = openai.ChatCompletion.create(
                model="gpt-4",
                messages=[{"role": "user", "content": prompt}],
                temperature=0.4,
            )
            resumen = response["choices"][0]["message"]["content"]
            st.success("Resumen generado")
            st.subheader("Resumen general del libro")
            st.write(resumen)

